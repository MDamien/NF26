SELECT d.jds, COUNT(*) AS q
FROM f_dw_ventes v, f_dw_date d
WHERE v.dat=d.dat
GROUP BY d.jds  
ORDER BY q desc;

SELECT avg(q) FROM
(
SELECT d.jds AS jds, COUNT(*) AS q
FROM f_dw_ventes v, f_dw_date d
WHERE v.dat=d.dat
GROUP BY d.jds
ORDER BY q desc
)
WHERE jds <> 'samedi';

CREATE OR REPLACE VIEW f_dw_ventesParJds AS
SELECT d.jds, COUNT(*) AS q
FROM f_dw_ventes v, f_dw_date d
WHERE v.dat=d.dat
GROUP BY d.jds
ORDER BY q desc;

CREATE OR REPLACE VIEW f_dw_ventesMoyHS AS
SELECT avg(q) as m
FROM f_dw_ventesParJds
WHERE jds <> 'samedi';

CREATE OR REPLACE VIEW f_dw_ratioVentesSamedi AS
SELECT s.jds AS jds, ROUND(s.q/hs.m,2) as r
FROM f_dw_ventesparjds s, f_dw_ventesmoyhs hs
WHERE jds = 'samedi';

SELECT * FROM f_dw_ratioVentesSamedi;






SELECT m.ray AS r1, COUNT(*) AS q1
FROM f_dw_ventes v, f_dw_magasin m
WHERE v.mag=m.mag
GROUP BY m.ray




SELECT m.ray AS r2, COUNT(*) AS q2
FROM f_dw_magasin m
GROUP BY m.ray



SELECT r1 AS Ray, q1 AS Ventes, q2 AS NbMag, ROUND(q1/q2) AS VentesParMag FROM
(SELECT m.ray AS r1, COUNT(*) AS q1
FROM f_dw_ventes v, f_dw_mag m
WHERE v.mag=m.mag
GROUP BY m.ray),
(SELECT m.ray AS r2, COUNT(*) AS q2
FROM f_dw_mag m
GROUP BY m.ray)
WHERE r1=r2
ORDER BY ventesParMag DESC;





